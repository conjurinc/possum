- !policy
  id: conjur/authn-k8s/minikube
  body:
  - !webservice

  - !policy
    id: ca
    body:
    - !variable
      id: cert
      annotations:
        description: CA cert for Kubernetes Pods.

    - !variable
      id: key
      annotations:
        description: CA key for Kubernetes Pods.
  
  - !group clients

  - !permit
    role: !group clients
    privilege: [ read, authenticate ]
    resource: !webservice

  - !policy
    id: apps
    annotations:
      description: Apps and services in the "minikube" Kubernetes cluster.
    body:
    - !layer

    - !host
      id: {{CONJUR_AUTHN_K8S_TEST_NAMESPACE}}/pod/inventory-pod
      annotations:
        kubernetes/authentication-container-name: authenticator

    - !grant
      role: !layer
      members: !host {{CONJUR_AUTHN_K8S_TEST_NAMESPACE}}/pod/inventory-pod

  - !grant
    role: !group clients
    member: !layer apps
