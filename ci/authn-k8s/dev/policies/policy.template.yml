- !policy
  id: conjur/authn-k8s/minikube
  body:
  - !webservice

  - !policy
    id: ca
    body:
    - !variable
      id: cert
      annotations:
        description: CA cert for Kubernetes Pods.

    - !variable
      id: key
      annotations:
        description: CA key for Kubernetes Pods.
  
  - !group clients

  - !permit
    role: !group clients
    privilege: [ read, authenticate ]
    resource: !webservice

  - !policy
    id: apps
    annotations:
      description: Apps and services in the "minikube" Kubernetes cluster.
    body:
    - !layer

    - !host
      id: test-6d77d3dd-7e28-46a4-90bf-bdf91972f1f6/pod/inventory-pod
      annotations:
        kubernetes/authentication-container-name: authenticator

    - !grant
      role: !layer
      members: !host test-6d77d3dd-7e28-46a4-90bf-bdf91972f1f6/pod/inventory-pod

  - !grant
    role: !group clients
    member: !layer apps
      
- !grant
  role: !group conjur/authn-k8s/minikube/clients
  member: !layer conjur/authn-k8s/minikube/apps
